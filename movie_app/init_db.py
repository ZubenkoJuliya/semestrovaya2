# init_db.py
from models import db, User, Movie, Review


def init_db(app):
    """Инициализация базы данных"""
    with app.app_context():
        db.create_all()
        # Создаем тестовые данные если база пустая
        if Movie.query.count() == 0:
            # Создаем админа
            admin = User(username='admin', email='admin@example.com', is_admin=True)
            admin.set_password('admin123')
            db.session.add(admin)

            # Создаем обычного пользователя
            user = User(username='user', email='user@example.com')
            user.set_password('user123')
            db.session.add(user)

            # Добавляем БОЛЬШЕ крутых фильмов!
            movies = [
                Movie(title='Интерстеллар', year=2014, director='Кристофер Нолан',
                      genre='Фантастика, Драма',
                      description='Фантастический эпос о космических путешествиях, поиске нового дома для человечества и силе любви.'),

                Movie(title='Крестный отец', year=1972, director='Фрэнсис Форд Коппола',
                      genre='Криминал, Драма',
                      description='Эпическая история мафиозной семьи Корлеоне в послевоенной Америке.'),

                Movie(title='Побег из Шоушенка', year=1994, director='Фрэнк Дарабонт',
                      genre='Драма',
                      description='История о надежде и свободе в тюрьме строгого режима.'),

                Movie(title='Начало', year=2010, director='Кристофер Нолан',
                      genre='Фантастика, Боевик',
                      description='Талантливый вор, промышляющий в мире снов, получает задание не украсть, а внедрить идею.'),

                Movie(title='Темный рыцарь', year=2008, director='Кристофер Нолан',
                      genre='Боевик, Криминал',
                      description='Бэтмен, комиссар Гордон и прокурор Харви Дент ведут войну с криминалом в Готэме.'),

                Movie(title='Форрест Гамп', year=1994, director='Роберт Земекис',
                      genre='Драма, Мелодрама',
                      description='История простого человека, ставшего свидетелем ключевых событий американской истории.'),

                Movie(title='Список Шиндлера', year=1993, director='Стивен Спилберг',
                      genre='Драма, Биография',
                      description='Немецкий предприниматель Оскар Шиндлер спасает более тысячи евреев во время Холокоста.'),

                Movie(title='Властелин колец: Возвращение короля', year=2003, director='Питер Джексон',
                      genre='Фэнтези, Приключения',
                      description='Завершение эпической трилогии о борьбе за Кольцо Всевластия.'),

                Movie(title='Бойцовский клуб', year=1999, director='Дэвид Финчер',
                      genre='Драма, Триллер',
                      description='История офисного работника, который встречает загадочного торговца мылом и создает подпольный бойцовский клуб.'),

                Movie(title='Джентльмены', year=2019, director='Гай Ричи',
                      genre='Криминал, Комедия',
                      description='Американский наркобарон пытается продать свой бизнес лондонскому олигарху.'),

                Movie(title='Дюна', year=2021, director='Дени Вильнёв',
                      genre='Фантастика, Драма',
                      description='Пол Атрейдес отправляется на опасную планету Арракис, чтобы защитить будущее своей семьи и народа.'),

                Movie(title='Оппенгеймер', year=2023, director='Кристофер Нолан',
                      genre='Драма, Биография',
                      description='История создания атомной бомбы и моральная дилемма ее создателя.'),

                Movie(title='Аватар', year=2009, director='Джеймс Кэмерон',
                      genre='Фантастика, Приключения',
                      description='Парализованный морпех становится частью программы по освоению планеты Пандора.'),

                Movie(title='Джокер', year=2019, director='Тодд Филлипс',
                      genre='Драма, Криминал',
                      description='История превращения неудачливого комика в психопата-преступника.'),

                Movie(title='Брат', year=1997, director='Алексей Балабанов',
                      genre='Криминал, Драма',
                      description='Демобилизованный солдат Данила Багров становится наемным убийцей в Петербурге.'),

                Movie(title='Легенда №17', year=2013, director='Николай Лебедев',
                      genre='Драма, Спорт',
                      description='История хоккеиста Валерия Харламова и легендарной суперсерии СССР-Канада 1972 года.'),

                Movie(title='Движение вверх', year=2017, director='Антон Мегердичев',
                      genre='Драма, Спорт',
                      description='История победы сборной СССР по баскетболу над американцами на Олимпиаде-1972.'),

                Movie(title='Игра престолов (сериал)', year=2011, director='Дэвид Бениофф, Д.Б. Уайсс',
                      genre='Фэнтези, Драма',
                      description='Борьба за Железный Трон в вымышленном мире Вестероса.'),

                Movie(title='Во все тяжкие (сериал)', year=2008, director='Винс Гиллиган',
                      genre='Криминал, Драма',
                      description='Школьный учитель химии становится наркобароном после того, как узнает, что болен раком.'),

                Movie(title='Иван Васильевич меняет профессию', year=1973, director='Леонид Гайдай',
                      genre='Комедия, Фантастика',
                      description='Изобретатель Шурик создает машину времени и случайно отправляет управдома в прошлое.'),

                Movie(title='Один дома', year=1990, director='Крис Коламбус',
                      genre='Комедия, Семейный',
                      description='8-летний Кевин остался один дома и защищает свой дом от грабителей.'),

                Movie(title='Унесенные призраками', year=2001, director='Хаяо Миядзаки',
                      genre='Аниме, Фэнтези',
                      description='Девочка Тихиро попадает в мир духов и пытается спасти своих родителей.'),

                Movie(title='Твоё имя', year=2016, director='Макото Синкай',
                      genre='Аниме, Мелодрама',
                      description='Парень и девушка из разных городов обнаруживают, что меняются телами во сне.'),

                Movie(title='Матрица', year=1999, director='Братья Вачовски',
                      genre='Фантастика, Боевик',
                      description='Хакер по имени Нео узнает, что мир, в котором он живет - это компьютерная симуляция.'),

                Movie(title='Бегущий по лезвию 2049', year=2017, director='Дени Вильнёв',
                      genre='Фантастика, Драма',
                      description='Охотник на андроидов раскрывает секрет, способный разрушить общество.'),

                Movie(title='Сияние', year=1980, director='Стэнли Кубрик',
                      genre='Ужасы, Драма',
                      description='Писатель с семьей поселяется в отеле, где на него воздействуют злые силы.'),

                Movie(title='Оно', year=2017, director='Андрес Мускетти',
                      genre='Ужасы',
                      description='Группа детей из городка Дерри сталкивается со злобным клоуном Пеннивайзом.'),

                Movie(title='Зеленая книга', year=2018, director='Питер Фаррелли',
                      genre='Драма, Комедия',
                      description='Путешествие афроамериканского пианиста и его итальянского водителя по югу США в 1960-х.'),

                Movie(title='1+1', year=2011, director='Оливье Накаш',
                      genre='Драма, Комедия',
                      description='Парализованный аристократ нанимает в сиделки бывшего заключенного.')
            ]

            for movie in movies:
                db.session.add(movie)

            db.session.commit()

            # Добавляем тестовые отзывы
            reviews = [
                Review(content='Невероятное кино! Графика и сюжет на высоте.', rating=5, user_id=1, movie_id=1),
                Review(content='Классика, которую должен посмотреть каждый.', rating=5, user_id=2, movie_id=2),
                Review(content='Трогательная история о надежде.', rating=5, user_id=1, movie_id=3),
                Review(content='Гениальный сюжет, Кристофер Нолан - гений!', rating=5, user_id=2, movie_id=4),
                Review(content='Лучший фильм про Бэтмена, Хит Леджер великолепен!', rating=5, user_id=1, movie_id=5),
                Review(content='Потрясающая актерская игра Тома Хэнкса.', rating=4, user_id=2, movie_id=6),
                Review(content='Тяжелый, но важный фильм о войне.', rating=5, user_id=1, movie_id=7),
                Review(content='Эпическое завершение трилогии.', rating=5, user_id=2, movie_id=8),
                Review(content='Культовый фильм Тарантино.', rating=4, user_id=1, movie_id=9),
                Review(content='Фильм, который меняет мировоззрение.', rating=5, user_id=2, movie_id=10)
            ]

            for review in reviews:
                db.session.add(review)

            db.session.commit()

            # Обновляем рейтинги фильмов
            for movie in Movie.query.all():
                movie.update_rating()

            db.session.commit()