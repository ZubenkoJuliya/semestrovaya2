{% extends "base.html" %}

{% block title %}{{ movie.title }} - –ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä{% endblock %}

{% block content %}
<div class="movie-detail">
    <div class="movie-header">
        <div class="movie-title-section">
            <h1>{{ movie.title }} <span class="year">({{ movie.year }})</span></h1>

            <div class="movie-meta">
                <span class="rating">‚òÖ {{ "%.1f"|format(movie.rating) }}</span>
                <span class="genre">{{ movie.genre or '–ñ–∞–Ω—Ä –Ω–µ —É–∫–∞–∑–∞–Ω' }}</span>
                <span class="director">{{ movie.director or '–†–µ–∂–∏—Å—Å–µ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω' }}</span>
                <span class="favorite-count">‚≠ê {{ movie.favorited_by.count() }}</span>
            </div>
        </div>

        <div class="movie-actions">
            {% if current_user.is_authenticated %}
            <form action="{{ url_for('toggle_favorite', movie_id=movie.id) }}" method="POST" class="favorite-form">
                <button type="submit" class="favorite-btn">
                    ‚òÜ –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                </button>
            </form>
            {% else %}
            <a href="{{ url_for('login') }}" class="btn">üîí –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
            {% endif %}

            {% if current_user.is_admin %}
            <div class="admin-actions">
                <a href="{{ url_for('edit_movie', movie_id=movie.id) }}" class="btn btn-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    —Ñ–∏–ª—å–º</a>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="movie-content">
        <div class="movie-description">
            <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
            <p>{{ movie.description or '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' }}</p>
        </div>

        <div class="reviews-section">
            <h3>–û—Ç–∑—ã–≤—ã ({{ reviews|length }})</h3>

            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
            {% if current_user.is_authenticated %}
            <div class="add-review">
                <h4>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h4>
                <form method="POST">
                    {{ form.hidden_tag() }}
                    <div class="form-group">
                        {{ form.rating.label }}
                        {{ form.rating(class="form-control") }}
                        {% if form.rating.errors %}
                        <div class="errors">
                            {% for error in form.rating.errors %}
                            <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {{ form.content.label }}
                        {{ form.content(class="form-control", rows=4, placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤ –∑–¥–µ—Å—å...") }}
                        {% if form.content.errors %}
                        <div class="errors">
                            {% for error in form.content.errors %}
                            <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {{ form.submit(class="btn btn-primary") }}
                </form>
            </div>
            {% else %}
            <div class="login-prompt">
                <p>üìù <a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π –æ—Ç–∑—ã–≤</p>
                <p>üëÄ –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –æ—Ç–∑—ã–≤—ã –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∏–∂–µ</p>
            </div>
            {% endif %}

            <!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ - –≤–∏–¥—è—Ç –í–°–ï -->
            <div class="reviews-list">
                {% if reviews %}
                {% for review in reviews %}
                <div class="review-card">
                    <div class="review-header">
                        <strong>{{ review.user.username }}</strong>
                        <span class="review-rating">‚òÖ {{ review.rating }}/5</span>
                        <span class="review-date">{{ review.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                    </div>
                    <p class="review-content">{{ review.content }}</p>
                </div>
                {% endfor %}
                {% else %}
                <div class="no-reviews">
                    <p>üòî –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ —ç—Ç–æ—Ç —Ñ–∏–ª—å–º.</p>
                    {% if not current_user.is_authenticated %}
                    <p><a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a> –∏ –±—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                    {% else %}
                    <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç –æ—Ç–∑—ã–≤!</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}