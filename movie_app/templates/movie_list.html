{% extends "base.html" %}

{% block title %}–í—Å–µ —Ñ–∏–ª—å–º—ã - –ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä{% endblock %}

{% block content %}
<h1>–í—Å–µ —Ñ–∏–ª—å–º—ã</h1>

<div class="filters">
    <form method="GET" class="filter-form">
        <div class="filter-group">
            <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                   value="{{ request.args.get('search', '') }}" class="search-input">
        </div>
        <div class="filter-group">
            <select name="genre" class="genre-select">
                <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                {% for genre in genres %}
                <option value="{{ genre }}" {% if request.args.get(
                'genre') == genre %}selected{% endif %}>
                {{ genre }}
                </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
        <a href="{{ url_for('movie_list') }}" class="btn">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>
</div>

{% if current_user.is_admin %}
<div class="admin-actions" style="margin-bottom: 20px;">
    <a href="{{ url_for('add_movie') }}" class="btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º</a>
</div>
{% endif %}

{% if movies.items %}
<div class="movies-grid">
    {% for movie in movies.items %}
    <div class="movie-card">
        {% if current_user.is_authenticated %}
        <div class="movie-actions">
            <form action="{{ url_for('toggle_favorite', movie_id=movie.id) }}" method="POST" class="favorite-form">
                <button type="submit" class="favorite-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">
                    ‚òÜ
                </button>
            </form>
        </div>
        {% endif %}
        <div class="movie-rating">‚òÖ {{ "%.1f"|format(movie.rating) }}</div>
        <h3><a href="{{ url_for('movie_detail', movie_id=movie.id) }}">{{ movie.title }}</a></h3>
        <p class="movie-year">{{ movie.year }}</p>
        <p class="movie-director">{{ movie.director or '–†–µ–∂–∏—Å—Å–µ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω' }}</p>
        <p class="movie-genre">{{ movie.genre or '–ñ–∞–Ω—Ä –Ω–µ —É–∫–∞–∑–∞–Ω' }}</p>
        <div class="movie-stats">
            <small>üí¨ {{ movie.reviews.count() }}</small>
        </div>
    </div>
    {% endfor %}
</div>

<div class="pagination">
    {% if movies.has_prev %}
    <a href="{{ url_for('movie_list', page=movies.prev_num, search=request.args.get('search'), genre=request.args.get('genre')) }}"
       class="page-link">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}

    <span class="page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ movies.page }} –∏–∑ {{ movies.pages }}</span>

    {% if movies.has_next %}
    <a href="{{ url_for('movie_list', page=movies.next_num, search=request.args.get('search'), genre=request.args.get('genre')) }}"
       class="page-link">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
    {% endif %}
</div>
{% else %}
<div class="no-results">
    <p>–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    {% if request.args.get('search') or request.args.get('genre') %}
    <a href="{{ url_for('movie_list') }}" class="btn">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}